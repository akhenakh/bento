"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[7146],{34922:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return i},default:function(){return p},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var r=t(85893),a=t(11151),s=t(74866),o=t(85162);const l={title:"dedupe",slug:"dedupe",type:"processor",status:"stable",categories:["Utility"],name:"dedupe"},i=void 0,c={id:"components/processors/dedupe",title:"dedupe",description:"\x3c!--",source:"@site/docs/components/processors/dedupe.md",sourceDirName:"components/processors",slug:"/components/processors/dedupe",permalink:"/docs/components/processors/dedupe",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/processors/dedupe.md",tags:[],version:"current",frontMatter:{title:"dedupe",slug:"dedupe",type:"processor",status:"stable",categories:["Utility"],name:"dedupe"},sidebar:"docs",previous:{title:"decompress",permalink:"/docs/components/processors/decompress"},next:{title:"for_each",permalink:"/docs/components/processors/for_each"}},u={},d=[{value:"Batch Deduplication",id:"batch-deduplication",level:2},{value:"Delivery Guarantees",id:"delivery-guarantees",level:2},{value:"Fields",id:"fields",level:2},{value:"<code>cache</code>",id:"cache",level:3},{value:"<code>key</code>",id:"key",level:3},{value:"<code>drop_on_err</code>",id:"drop_on_err",level:3},{value:"Examples",id:"examples",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Deduplicates messages by storing a key value in a cache using the ",(0,r.jsx)(n.code,{children:"add"})," operator. If the key already exists within the cache it is dropped."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'# Config fields, showing default values\nlabel: ""\ndedupe:\n  cache: "" # No default (required)\n  key: ${! meta("kafka_key") } # No default (required)\n  drop_on_err: true\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Caches must be configured as resources, for more information check out the ",(0,r.jsx)(n.a,{href:"/docs/components/caches/about",children:"cache documentation here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When using this processor with an output target that might fail you should always wrap the output within an indefinite ",(0,r.jsx)(n.a,{href:"/docs/components/outputs/retry",children:(0,r.jsx)(n.code,{children:"retry"})})," block. This ensures that during outages your messages aren't reprocessed after failures, which would result in messages being dropped."]}),"\n",(0,r.jsx)(n.h2,{id:"batch-deduplication",children:"Batch Deduplication"}),"\n",(0,r.jsxs)(n.p,{children:["This processor enacts on individual messages only, in order to perform a deduplication on behalf of a batch (or window) of messages instead use the ",(0,r.jsxs)(n.a,{href:"/docs/components/processors/cache#examples",children:[(0,r.jsx)(n.code,{children:"cache"})," processor"]}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"delivery-guarantees",children:"Delivery Guarantees"}),"\n",(0,r.jsx)(n.p,{children:"Performing deduplication on a stream using a distributed cache voids any at-least-once guarantees that it previously had. This is because the cache will preserve message signatures even if the message fails to leave the Bento pipeline, which would cause message loss in the event of an outage at the output sink followed by a restart of the Bento instance (or a server crash, etc)."}),"\n",(0,r.jsx)(n.p,{children:"This problem can be mitigated by using an in-memory cache and distributing messages to horizontally scaled Bento pipelines partitioned by the deduplication key. However, in situations where at-least-once delivery guarantees are important it is worth avoiding deduplication in favour of implement idempotent behaviour at the edge of your stream pipelines."}),"\n",(0,r.jsx)(n.h2,{id:"fields",children:"Fields"}),"\n",(0,r.jsx)(n.h3,{id:"cache",children:(0,r.jsx)(n.code,{children:"cache"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsxs)(n.a,{href:"/docs/components/caches/about",children:[(0,r.jsx)(n.code,{children:"cache"})," resource"]})," to target with this processor."]}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"string"})]}),"\n",(0,r.jsx)(n.h3,{id:"key",children:(0,r.jsx)(n.code,{children:"key"})}),"\n",(0,r.jsxs)(n.p,{children:["An interpolated string yielding the key to deduplicate by for each message.\nThis field supports ",(0,r.jsx)(n.a,{href:"/docs/configuration/interpolation#bloblang-queries",children:"interpolation functions"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"string"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'# Examples\n\nkey: ${! meta("kafka_key") }\n\nkey: ${! content().hash("xxhash64") }\n'})}),"\n",(0,r.jsx)(n.h3,{id:"drop_on_err",children:(0,r.jsx)(n.code,{children:"drop_on_err"})}),"\n",(0,r.jsx)(n.p,{children:"Whether messages should be dropped when the cache returns a general error such as a network issue."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"bool"}),(0,r.jsx)(n.br,{}),"\n","Default: ",(0,r.jsx)(n.code,{children:"true"})]}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.Z,{defaultValue:"Deduplicate based on Kafka key",values:[{label:"Deduplicate based on Kafka key",value:"Deduplicate based on Kafka key"}],children:(0,r.jsxs)(o.Z,{value:"Deduplicate based on Kafka key",children:[(0,r.jsx)(n.p,{children:"The following configuration demonstrates a pipeline that deduplicates messages based on the Kafka key."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'pipeline:\n  processors:\n    - dedupe:\n        cache: keycache\n        key: ${! meta("kafka_key") }\n\ncache_resources:\n  - label: keycache\n    memory:\n      default_ttl: 60s\n'})})]})})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},85162:function(e,n,t){t.d(n,{Z:function(){return o}});t(67294);var r=t(86010),a={tabItem:"tabItem_Ymn6"},s=t(85893);function o(e){let{children:n,hidden:t,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.Z)(a.tabItem,o),hidden:t,children:n})}},74866:function(e,n,t){t.d(n,{Z:function(){return k}});var r=t(67294),a=t(86010),s=t(12466),o=t(16550),l=t(20469),i=t(91980),c=t(67392),u=t(50012);function d(e){var n,t;return null!=(n=null==(t=r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}(t);return function(e){const n=(0,c.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const a=(0,o.k6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,i._X)(s),(0,r.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})}),[s,a])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,s=h(e),[o,i]=(0,r.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const a=null!=(n=r.find((e=>e.default)))?n:r[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:s}))),[c,d]=f({queryString:t,groupId:a}),[m,b]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[a,s]=(0,u.Nk)(t);return[a,(0,r.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:a}),g=(()=>{const e=null!=c?c:m;return p({value:e,tabValues:s})?e:null})();(0,l.Z)((()=>{g&&i(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);i(e),d(e),b(e)}),[d,b,s]),tabValues:s}}var b=t(72389),g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},v=t(85893);function y(e){let{className:n,block:t,selectedValue:r,selectValue:o,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.o5)(),u=e=>{const n=e.currentTarget,t=i.indexOf(n),a=l[t].value;a!==r&&(c(n),o(a))},d=e=>{var n;let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var r;const n=i.indexOf(e.currentTarget)+1;t=null!=(r=i[n])?r:i[0];break}case"ArrowLeft":{var a;const n=i.indexOf(e.currentTarget)-1;t=null!=(a=i[n])?a:i[i.length-1];break}}null==(n=t)||n.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>i.push(e),onKeyDown:d,onClick:u,...s,className:(0,a.Z)("tabs__item",g.tabItem,null==s?void 0:s.className,{"tabs__item--active":r===n}),children:null!=t?t:n},n)}))})}function x(e){let{lazy:n,children:t,selectedValue:a}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function j(e){const n=m(e);return(0,v.jsxs)("div",{className:(0,a.Z)("tabs-container",g.tabList),children:[(0,v.jsx)(y,{...e,...n}),(0,v.jsx)(x,{...e,...n})]})}function k(e){const n=(0,b.Z)();return(0,v.jsx)(j,{...e,children:d(e.children)},String(n))}},11151:function(e,n,t){t.d(n,{Z:function(){return l},a:function(){return o}});var r=t(67294);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);