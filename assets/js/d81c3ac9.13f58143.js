"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[4688],{63881:function(e,n,s){s.r(n),s.d(n,{assets:function(){return u},contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return c},metadata:function(){return i},toc:function(){return d}});var r=s(85893),t=s(11151),o=s(74866),a=s(85162);const c={title:"subprocess",slug:"subprocess",type:"processor",status:"stable",categories:["Integration"],name:"subprocess"},l=void 0,i={id:"components/processors/subprocess",title:"subprocess",description:"\x3c!--",source:"@site/docs/components/processors/subprocess.md",sourceDirName:"components/processors",slug:"/components/processors/subprocess",permalink:"/bento/docs/components/processors/subprocess",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/processors/subprocess.md",tags:[],version:"current",frontMatter:{title:"subprocess",slug:"subprocess",type:"processor",status:"stable",categories:["Integration"],name:"subprocess"},sidebar:"docs",previous:{title:"sql_select",permalink:"/bento/docs/components/processors/sql_select"},next:{title:"switch",permalink:"/bento/docs/components/processors/switch"}},u={},d=[{value:"Subprocess requirements",id:"subprocess-requirements",level:2},{value:"Messages containing line breaks",id:"messages-containing-line-breaks",level:2},{value:"Fields",id:"fields",level:2},{value:"<code>name</code>",id:"name",level:3},{value:"<code>args</code>",id:"args",level:3},{value:"<code>max_buffer</code>",id:"max_buffer",level:3},{value:"<code>codec_send</code>",id:"codec_send",level:3},{value:"<code>codec_recv</code>",id:"codec_recv",level:3}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Executes a command as a subprocess and, for each message, will pipe its contents to the stdin stream of the process followed by a newline."}),"\n",(0,r.jsxs)(o.Z,{defaultValue:"common",values:[{label:"Common",value:"common"},{label:"Advanced",value:"advanced"}],children:[(0,r.jsx)(a.Z,{value:"common",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'# Common config fields, showing default values\nlabel: ""\nsubprocess:\n  name: cat # No default (required)\n  args: []\n'})})}),(0,r.jsx)(a.Z,{value:"advanced",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'# All config fields, showing default values\nlabel: ""\nsubprocess:\n  name: cat # No default (required)\n  args: []\n  max_buffer: 65536\n  codec_send: lines\n  codec_recv: lines\n'})})})]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["This processor keeps the subprocess alive and requires very specific behaviour from the command executed. If you wish to simply execute a command for each message take a look at the ",(0,r.jsxs)(n.a,{href:"/docs/components/processors/command",children:[(0,r.jsx)(n.code,{children:"command"})," processor"]})," instead."]})}),"\n",(0,r.jsxs)(n.p,{children:["The subprocess must then either return a line over stdout or stderr. If a response is returned over stdout then its contents will replace the message. If a response is instead returned from stderr it will be logged and the message will continue unchanged and will be ",(0,r.jsx)(n.a,{href:"/docs/configuration/error_handling",children:"marked as failed"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Rather than separating data by a newline it's possible to specify alternative ",(0,r.jsx)(n.a,{href:"#codec_send",children:(0,r.jsx)(n.code,{children:"codec_send"})})," and ",(0,r.jsx)(n.a,{href:"#codec_recv",children:(0,r.jsx)(n.code,{children:"codec_recv"})})," values, which allow binary messages to be encoded for logical separation."]}),"\n",(0,r.jsx)(n.p,{children:"The execution environment of the subprocess is the same as the Bento instance, including environment variables and the current working directory."}),"\n",(0,r.jsxs)(n.p,{children:["The field ",(0,r.jsx)(n.code,{children:"max_buffer"})," defines the maximum response size able to be read from the subprocess. This value should be set significantly above the real expected maximum response size."]}),"\n",(0,r.jsx)(n.h2,{id:"subprocess-requirements",children:"Subprocess requirements"}),"\n",(0,r.jsx)(n.p,{children:"It is required that subprocesses flush their stdout and stderr pipes for each line. Bento will attempt to keep the process alive for as long as the pipeline is running. If the process exits early it will be restarted."}),"\n",(0,r.jsx)(n.h2,{id:"messages-containing-line-breaks",children:"Messages containing line breaks"}),"\n",(0,r.jsx)(n.p,{children:"If a message contains line breaks each line of the message is piped to the subprocess and flushed, and a response is expected from the subprocess before another line is fed in."}),"\n",(0,r.jsx)(n.h2,{id:"fields",children:"Fields"}),"\n",(0,r.jsx)(n.h3,{id:"name",children:(0,r.jsx)(n.code,{children:"name"})}),"\n",(0,r.jsx)(n.p,{children:"The command to execute as a subprocess."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"string"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:"# Examples\n\nname: cat\n\nname: sed\n\nname: awk\n"})}),"\n",(0,r.jsx)(n.h3,{id:"args",children:(0,r.jsx)(n.code,{children:"args"})}),"\n",(0,r.jsx)(n.p,{children:"A list of arguments to provide the command."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"array"}),(0,r.jsx)(n.br,{}),"\n","Default: ",(0,r.jsx)(n.code,{children:"[]"})]}),"\n",(0,r.jsx)(n.h3,{id:"max_buffer",children:(0,r.jsx)(n.code,{children:"max_buffer"})}),"\n",(0,r.jsx)(n.p,{children:"The maximum expected response size."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"int"}),(0,r.jsx)(n.br,{}),"\n","Default: ",(0,r.jsx)(n.code,{children:"65536"})]}),"\n",(0,r.jsx)(n.h3,{id:"codec_send",children:(0,r.jsx)(n.code,{children:"codec_send"})}),"\n",(0,r.jsx)(n.p,{children:"Determines how messages written to the subprocess are encoded, which allows them to be logically separated."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"string"}),(0,r.jsx)(n.br,{}),"\n","Default: ",(0,r.jsx)(n.code,{children:'"lines"'}),(0,r.jsx)(n.br,{}),"\n","Requires version 3.37.0 or newer",(0,r.jsx)(n.br,{}),"\n","Options: ",(0,r.jsx)(n.code,{children:"lines"}),", ",(0,r.jsx)(n.code,{children:"length_prefixed_uint32_be"}),", ",(0,r.jsx)(n.code,{children:"netstring"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"codec_recv",children:(0,r.jsx)(n.code,{children:"codec_recv"})}),"\n",(0,r.jsx)(n.p,{children:"Determines how messages read from the subprocess are decoded, which allows them to be logically separated."}),"\n",(0,r.jsxs)(n.p,{children:["Type: ",(0,r.jsx)(n.code,{children:"string"}),(0,r.jsx)(n.br,{}),"\n","Default: ",(0,r.jsx)(n.code,{children:'"lines"'}),(0,r.jsx)(n.br,{}),"\n","Requires version 3.37.0 or newer",(0,r.jsx)(n.br,{}),"\n","Options: ",(0,r.jsx)(n.code,{children:"lines"}),", ",(0,r.jsx)(n.code,{children:"length_prefixed_uint32_be"}),", ",(0,r.jsx)(n.code,{children:"netstring"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},85162:function(e,n,s){s.d(n,{Z:function(){return a}});s(67294);var r=s(86010),t={tabItem:"tabItem_Ymn6"},o=s(85893);function a(e){let{children:n,hidden:s,className:a}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.Z)(t.tabItem,a),hidden:s,children:n})}},74866:function(e,n,s){s.d(n,{Z:function(){return y}});var r=s(67294),t=s(86010),o=s(12466),a=s(16550),c=s(20469),l=s(91980),i=s(67392),u=s(50012);function d(e){var n,s;return null!=(n=null==(s=r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:s.filter(Boolean))?n:[]}function h(e){const{values:n,children:s}=e;return(0,r.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:s,attributes:r,default:t}}=e;return{value:n,label:s,attributes:r,default:t}}))}(s);return function(e){const n=(0,i.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,s])}function p(e){let{value:n,tabValues:s}=e;return s.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:s}=e;const t=(0,a.k6)(),o=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=s?s:null}({queryString:n,groupId:s});return[(0,l._X)(o),(0,r.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})}),[o,t])]}function f(e){const{defaultValue:n,queryString:s=!1,groupId:t}=e,o=h(e),[a,l]=(0,r.useState)((()=>function(e){var n;let{defaultValue:s,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!p({value:s,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+s+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return s}const t=null!=(n=r.find((e=>e.default)))?n:r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:o}))),[i,d]=m({queryString:s,groupId:t}),[f,b]=function(e){let{groupId:n}=e;const s=function(e){return e?"docusaurus.tab."+e:null}(n),[t,o]=(0,u.Nk)(s);return[t,(0,r.useCallback)((e=>{s&&o.set(e)}),[s,o])]}({groupId:t}),x=(()=>{const e=null!=i?i:f;return p({value:e,tabValues:o})?e:null})();(0,c.Z)((()=>{x&&l(x)}),[x]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error("Can't select invalid tab value="+e);l(e),d(e),b(e)}),[d,b,o]),tabValues:o}}var b=s(72389),x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},v=s(85893);function g(e){let{className:n,block:s,selectedValue:r,selectValue:a,tabValues:c}=e;const l=[],{blockElementScrollPositionUntilNextRender:i}=(0,o.o5)(),u=e=>{const n=e.currentTarget,s=l.indexOf(n),t=c[s].value;t!==r&&(i(n),a(t))},d=e=>{var n;let s=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var r;const n=l.indexOf(e.currentTarget)+1;s=null!=(r=l[n])?r:l[0];break}case"ArrowLeft":{var t;const n=l.indexOf(e.currentTarget)-1;s=null!=(t=l[n])?t:l[l.length-1];break}}null==(n=s)||n.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.Z)("tabs",{"tabs--block":s},n),children:c.map((e=>{let{value:n,label:s,attributes:o}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:d,onClick:u,...o,className:(0,t.Z)("tabs__item",x.tabItem,null==o?void 0:o.className,{"tabs__item--active":r===n}),children:null!=s?s:n},n)}))})}function j(e){let{lazy:n,children:s,selectedValue:t}=e;const o=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function w(e){const n=f(e);return(0,v.jsxs)("div",{className:(0,t.Z)("tabs-container",x.tabList),children:[(0,v.jsx)(g,{...e,...n}),(0,v.jsx)(j,{...e,...n})]})}function y(e){const n=(0,b.Z)();return(0,v.jsx)(w,{...e,children:d(e.children)},String(n))}},11151:function(e,n,s){s.d(n,{Z:function(){return c},a:function(){return a}});var r=s(67294);const t={},o=r.createContext(t);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);