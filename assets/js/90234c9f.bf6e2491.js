"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[7232],{6551:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return d}});var a=t(5893),r=t(1151),o=t(4866),s=t(5162);const i={title:"mapping",slug:"mapping",type:"processor",status:"stable",categories:["Mapping","Parsing"],name:"mapping"},l=void 0,c={id:"components/processors/mapping",title:"mapping",description:"\x3c!--",source:"@site/docs/components/processors/mapping.md",sourceDirName:"components/processors",slug:"/components/processors/mapping",permalink:"/bento/docs/components/processors/mapping",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/processors/mapping.md",tags:[],version:"current",frontMatter:{title:"mapping",slug:"mapping",type:"processor",status:"stable",categories:["Mapping","Parsing"],name:"mapping"},sidebar:"docs",previous:{title:"log",permalink:"/bento/docs/components/processors/log"},next:{title:"metric",permalink:"/bento/docs/components/processors/metric"}},u={},d=[{value:"Input Document Immutability",id:"input-document-immutability",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Examples",id:"examples",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Executes a ",(0,a.jsx)(n.a,{href:"/docs/guides/bloblang/about",children:"Bloblang"})," mapping on messages, creating a new document that replaces (or filters) the original message."]}),"\n",(0,a.jsx)(n.p,{children:"Introduced in version 4.5.0."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# Config fields, showing default values\nlabel: ""\nmapping: "" # No default (required)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Bloblang is a powerful language that enables a wide range of mapping, transformation and filtering tasks. For more information ",(0,a.jsx)(n.a,{href:"/docs/guides/bloblang/about",children:"check out the docs"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["If your mapping is large and you'd prefer for it to live in a separate file then you can execute a mapping directly from a file with the expression ",(0,a.jsx)(n.code,{children:'from "<path>"'}),", where the path must be absolute, or relative from the location that Bento is executed from."]}),"\n",(0,a.jsxs)(n.p,{children:["Note: This processor is equivalent to the ",(0,a.jsx)(n.a,{href:"/docs/components/processors/bloblang#component-rename",children:"bloblang"})," one. The latter will be deprecated in a future release."]}),"\n",(0,a.jsx)(n.h2,{id:"input-document-immutability",children:"Input Document Immutability"}),"\n",(0,a.jsx)(n.p,{children:"Mapping operates by creating an entirely new object during assignments, this has the advantage of treating the original referenced document as immutable and therefore queryable at any stage of your mapping. For example, with the following mapping:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-coffee",children:"root.id = this.id\nroot.invitees = this.invitees.filter(i -> i.mood >= 0.5)\nroot.rejected = this.invitees.filter(i -> i.mood < 0.5)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Notice that we mutate the value of ",(0,a.jsx)(n.code,{children:"invitees"})," in the resulting document by filtering out objects with a lower mood. However, even after doing so we're still able to reference the unchanged original contents of this value from the input document in order to populate a second field. Within this mapping we also have the flexibility to reference the mutable mapped document by using the keyword ",(0,a.jsx)(n.code,{children:"root"})," (i.e. ",(0,a.jsx)(n.code,{children:"root.invitees"}),") on the right-hand side instead."]}),"\n",(0,a.jsxs)(n.p,{children:["Mapping documents is advantageous in situations where the result is a document with a dramatically different shape to the input document, since we are effectively rebuilding the document in its entirety and might as well keep a reference to the unchanged input document throughout. However, in situations where we are only performing minor alterations to the input document, the rest of which is unchanged, it might be more efficient to use the ",(0,a.jsxs)(n.a,{href:"/docs/components/processors/mutation",children:[(0,a.jsx)(n.code,{children:"mutation"})," processor"]})," instead."]}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsxs)(n.p,{children:["Bloblang mappings can fail, in which case the message remains unchanged, errors are logged, and the message is flagged as having failed, allowing you to use ",(0,a.jsx)(n.a,{href:"/docs/configuration/error_handling",children:"standard processor error handling patterns"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["However, Bloblang itself also provides powerful ways of ensuring your mappings do not fail by specifying desired fallback behaviour, which you can read about ",(0,a.jsx)(n.a,{href:"/docs/guides/bloblang/about#error-handling",children:"in this section"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsxs)(o.Z,{defaultValue:"Mapping",values:[{label:"Mapping",value:"Mapping"},{label:"More Mapping",value:"More Mapping"}],children:[(0,a.jsxs)(s.Z,{value:"Mapping",children:[(0,a.jsx)(n.p,{children:"Given JSON documents containing an array of fans:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "id":"foo",\n  "description":"a show about foo",\n  "fans":[\n    {"name":"bev","obsession":0.57},\n    {"name":"grace","obsession":0.21},\n    {"name":"ali","obsession":0.89},\n    {"name":"vic","obsession":0.43}\n  ]\n}\n'})}),(0,a.jsx)(n.p,{children:"We can reduce the documents down to just the ID and only those fans with an obsession score above 0.5, giving us:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "id":"foo",\n  "fans":[\n    {"name":"bev","obsession":0.57},\n    {"name":"ali","obsession":0.89}\n  ]\n}\n'})}),(0,a.jsx)(n.p,{children:"With the following config:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"pipeline:\n  processors:\n    - mapping: |\n        root.id = this.id\n        root.fans = this.fans.filter(fan -> fan.obsession > 0.5)\n"})})]}),(0,a.jsxs)(s.Z,{value:"More Mapping",children:[(0,a.jsx)(n.p,{children:"When receiving JSON documents of the form:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "locations": [\n    {"name": "Seattle", "state": "WA"},\n    {"name": "New York", "state": "NY"},\n    {"name": "Bellevue", "state": "WA"},\n    {"name": "Olympia", "state": "WA"}\n  ]\n}\n'})}),(0,a.jsxs)(n.p,{children:["We could collapse the location names from the state of Washington into a field ",(0,a.jsx)(n.code,{children:"Cities"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{"Cities": "Bellevue, Olympia, Seattle"}\n'})}),(0,a.jsx)(n.p,{children:"With the following config:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'pipeline:\n  processors:\n    - mapping: |\n        root.Cities = this.locations.\n                        filter(loc -> loc.state == "WA").\n                        map_each(loc -> loc.name).\n                        sort().join(", ")\n'})})]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},5162:function(e,n,t){t.d(n,{Z:function(){return s}});t(7294);var a=t(6010),r={tabItem:"tabItem_Ymn6"},o=t(5893);function s(e){let{children:n,hidden:t,className:s}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,s),hidden:t,children:n})}},4866:function(e,n,t){t.d(n,{Z:function(){return y}});var a=t(7294),r=t(6010),o=t(2466),s=t(6550),i=t(469),l=t(1980),c=t(7392),u=t(12);function d(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:r}}=e;return{value:n,label:t,attributes:a,default:r}}))}(t);return function(e){const n=(0,c.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function h(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const r=(0,s.k6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})}),[o,r])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,o=p(e),[s,l]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const r=null!=(n=a.find((e=>e.default)))?n:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:o}))),[c,d]=m({queryString:t,groupId:r}),[f,g]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,o]=(0,u.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:r}),b=(()=>{const e=null!=c?c:f;return h({value:e,tabValues:o})?e:null})();(0,i.Z)((()=>{b&&l(b)}),[b]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error("Can't select invalid tab value="+e);l(e),d(e),g(e)}),[d,g,o]),tabValues:o}}var g=t(2389),b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},v=t(5893);function x(e){let{className:n,block:t,selectedValue:a,selectValue:s,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.o5)(),u=e=>{const n=e.currentTarget,t=l.indexOf(n),r=i[t].value;r!==a&&(c(n),s(r))},d=e=>{var n;let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var a;const n=l.indexOf(e.currentTarget)+1;t=null!=(a=l[n])?a:l[0];break}case"ArrowLeft":{var r;const n=l.indexOf(e.currentTarget)-1;t=null!=(r=l[n])?r:l[l.length-1];break}}null==(n=t)||n.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n),children:i.map((e=>{let{value:n,label:t,attributes:o}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>l.push(e),onKeyDown:d,onClick:u,...o,className:(0,r.Z)("tabs__item",b.tabItem,null==o?void 0:o.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function j(e){let{lazy:n,children:t,selectedValue:r}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=f(e);return(0,v.jsxs)("div",{className:(0,r.Z)("tabs-container",b.tabList),children:[(0,v.jsx)(x,{...e,...n}),(0,v.jsx)(j,{...e,...n})]})}function y(e){const n=(0,g.Z)();return(0,v.jsx)(w,{...e,children:d(e.children)},String(n))}},1151:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return s}});var a=t(7294);const r={},o=a.createContext(r);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);