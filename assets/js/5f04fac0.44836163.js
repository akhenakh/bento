"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[8291],{58409:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return l},metadata:function(){return i},toc:function(){return d}});var r=n(85893),o=n(11151),s=n(74866),a=n(85162);const l={title:"drop_on",slug:"drop_on",type:"output",status:"stable",categories:["Utility"],name:"drop_on"},u=void 0,i={id:"components/outputs/drop_on",title:"drop_on",description:"\x3c!--",source:"@site/docs/components/outputs/drop_on.md",sourceDirName:"components/outputs",slug:"/components/outputs/drop_on",permalink:"/bento/docs/components/outputs/drop_on",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/outputs/drop_on.md",tags:[],version:"current",frontMatter:{title:"drop_on",slug:"drop_on",type:"output",status:"stable",categories:["Utility"],name:"drop_on"},sidebar:"docs",previous:{title:"drop",permalink:"/bento/docs/components/outputs/drop"},next:{title:"dynamic",permalink:"/bento/docs/components/outputs/dynamic"}},c={},d=[{value:"Fields",id:"fields",level:2},{value:"<code>error</code>",id:"error",level:3},{value:"<code>error_patterns</code>",id:"error_patterns",level:3},{value:"<code>back_pressure</code>",id:"back_pressure",level:3},{value:"<code>output</code>",id:"output",level:3},{value:"Examples",id:"examples",level:2}];function p(e){const t={br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Attempts to write messages to a child output and if the write fails for one of a list of configurable reasons the message is dropped (acked) instead of being reattempted (or nacked)."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yml",children:'# Config fields, showing default values\noutput:\n  label: ""\n  drop_on:\n    error: false\n    error_patterns: [] # No default (optional)\n    back_pressure: 30s # No default (optional)\n    output: null # No default (required)\n'})}),"\n",(0,r.jsx)(t.p,{children:"Regular Bento outputs will apply back pressure when downstream services aren't accessible, and Bento retries (or nacks) all messages that fail to be delivered. However, in some circumstances, or for certain output types, we instead might want to relax these mechanisms, which is when this output becomes useful."}),"\n",(0,r.jsx)(t.h2,{id:"fields",children:"Fields"}),"\n",(0,r.jsx)(t.h3,{id:"error",children:(0,r.jsx)(t.code,{children:"error"})}),"\n",(0,r.jsxs)(t.p,{children:["Whether messages should be dropped when the child output returns an error of any type. For example, this could be when an ",(0,r.jsx)(t.code,{children:"http_client"})," output gets a 4XX response code. In order to instead drop only on specific error patterns use the ",(0,r.jsx)(t.code,{children:"error_matches"})," field instead."]}),"\n",(0,r.jsxs)(t.p,{children:["Type: ",(0,r.jsx)(t.code,{children:"bool"}),(0,r.jsx)(t.br,{}),"\n","Default: ",(0,r.jsx)(t.code,{children:"false"})]}),"\n",(0,r.jsx)(t.h3,{id:"error_patterns",children:(0,r.jsx)(t.code,{children:"error_patterns"})}),"\n",(0,r.jsx)(t.p,{children:"A list of regular expressions (re2) where if the child output returns an error that matches any part of any of these patterns the message will be dropped."}),"\n",(0,r.jsxs)(t.p,{children:["Type: ",(0,r.jsx)(t.code,{children:"array"}),(0,r.jsx)(t.br,{}),"\n","Requires version 4.27.0 or newer"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yml",children:"# Examples\n\nerror_patterns:\n  - and that was really bad$\n\nerror_patterns:\n  - roughly [0-9]+ issues occurred\n"})}),"\n",(0,r.jsx)(t.h3,{id:"back_pressure",children:(0,r.jsx)(t.code,{children:"back_pressure"})}),"\n",(0,r.jsxs)(t.p,{children:["An optional duration string that determines the maximum length of time to wait for a given message to be accepted by the child output before the message should be dropped instead. The most common reason for an output to block is when waiting for a lost connection to be re-established. Once a message has been dropped due to back pressure all subsequent messages are dropped immediately until the output is ready to process them again. Note that if ",(0,r.jsx)(t.code,{children:"error"})," is set to ",(0,r.jsx)(t.code,{children:"false"})," and this field is specified then messages dropped due to back pressure will return an error response (are nacked or reattempted)."]}),"\n",(0,r.jsxs)(t.p,{children:["Type: ",(0,r.jsx)(t.code,{children:"string"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yml",children:"# Examples\n\nback_pressure: 30s\n\nback_pressure: 1m\n"})}),"\n",(0,r.jsx)(t.h3,{id:"output",children:(0,r.jsx)(t.code,{children:"output"})}),"\n",(0,r.jsx)(t.p,{children:"A child output to wrap with this drop mechanism."}),"\n",(0,r.jsxs)(t.p,{children:["Type: ",(0,r.jsx)(t.code,{children:"output"})]}),"\n",(0,r.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsxs)(s.Z,{defaultValue:"Dropping failed HTTP requests",values:[{label:"Dropping failed HTTP requests",value:"Dropping failed HTTP requests"},{label:"Dropping from outputs that cannot connect",value:"Dropping from outputs that cannot connect"}],children:[(0,r.jsxs)(a.Z,{value:"Dropping failed HTTP requests",children:[(0,r.jsx)(t.p,{children:"In this example we have a fan_out broker, where we guarantee delivery to our Kafka output, but drop messages if they fail our secondary HTTP client output."}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"output:\n  broker:\n    pattern: fan_out\n    outputs:\n      - kafka:\n          addresses: [ foobar:6379 ]\n          topic: foo\n      - drop_on:\n          error: true\n          output:\n            http_client:\n              url: http://example.com/foo/messages\n              verb: POST\n"})})]}),(0,r.jsxs)(a.Z,{value:"Dropping from outputs that cannot connect",children:[(0,r.jsx)(t.p,{children:"Most outputs that attempt to establish and long-lived connection will apply back-pressure when the connection is lost. The following example has a websocket output where if it takes longer than 10 seconds to establish a connection, or recover a lost one, pending messages are dropped."}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"output:\n  drop_on:\n    back_pressure: 10s\n    output:\n      websocket:\n        url: ws://example.com/foo/messages\n"})})]})]})]})}function h(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},85162:function(e,t,n){n.d(t,{Z:function(){return a}});n(67294);var r=n(86010),o={tabItem:"tabItem_Ymn6"},s=n(85893);function a(e){let{children:t,hidden:n,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,a),hidden:n,children:t})}},74866:function(e,t,n){n.d(t,{Z:function(){return y}});var r=n(67294),o=n(86010),s=n(12466),a=n(16550),l=n(20469),u=n(91980),i=n(67392),c=n(50012);function d(e){var t,n;return null!=(t=null==(n=r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}function p(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=null!=t?t:function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:o}}=e;return{value:t,label:n,attributes:r,default:o}}))}(n);return function(e){const t=(0,i.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const o=(0,a.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,u._X)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(o.location.search);t.set(s,e),o.replace({...o.location,search:t.toString()})}),[s,o])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:o}=e,s=p(e),[a,u]=(0,r.useState)((()=>function(e){var t;let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}const o=null!=(t=r.find((e=>e.default)))?t:r[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:t,tabValues:s}))),[i,d]=m({queryString:n,groupId:o}),[f,b]=function(e){let{groupId:t}=e;const n=function(e){return e?"docusaurus.tab."+e:null}(t),[o,s]=(0,c.Nk)(n);return[o,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:o}),g=(()=>{const e=null!=i?i:f;return h({value:e,tabValues:s})?e:null})();(0,l.Z)((()=>{g&&u(g)}),[g]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);u(e),d(e),b(e)}),[d,b,s]),tabValues:s}}var b=n(72389),g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},x=n(85893);function v(e){let{className:t,block:n,selectedValue:r,selectValue:a,tabValues:l}=e;const u=[],{blockElementScrollPositionUntilNextRender:i}=(0,s.o5)(),c=e=>{const t=e.currentTarget,n=u.indexOf(t),o=l[n].value;o!==r&&(i(t),a(o))},d=e=>{var t;let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{var r;const t=u.indexOf(e.currentTarget)+1;n=null!=(r=u[t])?r:u[0];break}case"ArrowLeft":{var o;const t=u.indexOf(e.currentTarget)-1;n=null!=(o=u[t])?o:u[u.length-1];break}}null==(t=n)||t.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t),children:l.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>u.push(e),onKeyDown:d,onClick:c,...s,className:(0,o.Z)("tabs__item",g.tabItem,null==s?void 0:s.className,{"tabs__item--active":r===t}),children:null!=n?n:t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:o}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===o));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:s.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==o})))})}function w(e){const t=f(e);return(0,x.jsxs)("div",{className:(0,o.Z)("tabs-container",g.tabList),children:[(0,x.jsx)(v,{...e,...t}),(0,x.jsx)(j,{...e,...t})]})}function y(e){const t=(0,b.Z)();return(0,x.jsx)(w,{...e,children:d(e.children)},String(t))}},11151:function(e,t,n){n.d(t,{Z:function(){return l},a:function(){return a}});var r=n(67294);const o={},s=r.createContext(o);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);