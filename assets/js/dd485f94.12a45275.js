"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[9910],{55581:function(e,s,n){n.r(s),n.d(s,{assets:function(){return u},contentTitle:function(){return c},default:function(){return p},frontMatter:function(){return l},metadata:function(){return i},toc:function(){return d}});var t=n(85893),r=n(11151),a=n(74866),o=n(85162);const l={title:"switch",slug:"switch",type:"processor",status:"stable",categories:["Composition"],name:"switch"},c=void 0,i={id:"components/processors/switch",title:"switch",description:"\x3c!--",source:"@site/docs/components/processors/switch.md",sourceDirName:"components/processors",slug:"/components/processors/switch",permalink:"/bento/docs/components/processors/switch",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/processors/switch.md",tags:[],version:"current",frontMatter:{title:"switch",slug:"switch",type:"processor",status:"stable",categories:["Composition"],name:"switch"},sidebar:"docs",previous:{title:"subprocess",permalink:"/bento/docs/components/processors/subprocess"},next:{title:"sync_response",permalink:"/bento/docs/components/processors/sync_response"}},u={},d=[{value:"Fields",id:"fields",level:2},{value:"<code>[].check</code>",id:"check",level:3},{value:"<code>[].processors</code>",id:"processors",level:3},{value:"<code>[].fallthrough</code>",id:"fallthrough",level:3},{value:"Examples",id:"examples",level:2},{value:"Batching",id:"batching",level:2}];function h(e){const s={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Conditionally processes messages based on their contents."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yml",children:'# Config fields, showing default values\nlabel: ""\nswitch: [] # No default (required)\n'})}),"\n",(0,t.jsxs)(s.p,{children:["For each switch case a ",(0,t.jsx)(s.a,{href:"/docs/guides/bloblang/about",children:"Bloblang query"})," is checked and, if the result is true (or the check is empty) the child processors are executed on the message."]}),"\n",(0,t.jsx)(s.h2,{id:"fields",children:"Fields"}),"\n",(0,t.jsx)(s.h3,{id:"check",children:(0,t.jsx)(s.code,{children:"[].check"})}),"\n",(0,t.jsxs)(s.p,{children:["A ",(0,t.jsx)(s.a,{href:"/docs/guides/bloblang/about",children:"Bloblang query"})," that should return a boolean value indicating whether a message should have the processors of this case executed on it. If left empty the case always passes. If the check mapping throws an error the message will be flagged ",(0,t.jsx)(s.a,{href:"/docs/configuration/error_handling",children:"as having failed"})," and will not be tested against any other cases."]}),"\n",(0,t.jsxs)(s.p,{children:["Type: ",(0,t.jsx)(s.code,{children:"string"}),(0,t.jsx)(s.br,{}),"\n","Default: ",(0,t.jsx)(s.code,{children:'""'})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yml",children:'# Examples\n\ncheck: this.type == "foo"\n\ncheck: this.contents.urls.contains("https://benthos.dev/")\n'})}),"\n",(0,t.jsx)(s.h3,{id:"processors",children:(0,t.jsx)(s.code,{children:"[].processors"})}),"\n",(0,t.jsxs)(s.p,{children:["A list of ",(0,t.jsx)(s.a,{href:"/docs/components/processors/about/",children:"processors"})," to execute on a message."]}),"\n",(0,t.jsxs)(s.p,{children:["Type: ",(0,t.jsx)(s.code,{children:"array"}),(0,t.jsx)(s.br,{}),"\n","Default: ",(0,t.jsx)(s.code,{children:"[]"})]}),"\n",(0,t.jsx)(s.h3,{id:"fallthrough",children:(0,t.jsx)(s.code,{children:"[].fallthrough"})}),"\n",(0,t.jsx)(s.p,{children:"Indicates whether, if this case passes for a message, the next case should also be executed."}),"\n",(0,t.jsxs)(s.p,{children:["Type: ",(0,t.jsx)(s.code,{children:"bool"}),(0,t.jsx)(s.br,{}),"\n","Default: ",(0,t.jsx)(s.code,{children:"false"})]}),"\n",(0,t.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(a.Z,{defaultValue:"I Hate George",values:[{label:"I Hate George",value:"I Hate George"}],children:(0,t.jsxs)(o.Z,{value:"I Hate George",children:[(0,t.jsx)(s.p,{children:"We have a system where we're counting a metric for all messages that pass through our system. However, occasionally we get messages from George where he's rambling about dumb stuff we don't care about."}),(0,t.jsx)(s.p,{children:"For Georges messages we want to instead emit a metric that gauges how angry he is about being ignored and then we drop it."}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'pipeline:\n  processors:\n    - switch:\n        - check: this.user.name.first != "George"\n          processors:\n            - metric:\n                type: counter\n                name: MessagesWeCareAbout\n\n        - processors:\n            - metric:\n                type: gauge\n                name: GeorgesAnger\n                value: ${! json("user.anger") }\n            - mapping: root = deleted()\n'})})]})}),"\n",(0,t.jsx)(s.h2,{id:"batching",children:"Batching"}),"\n",(0,t.jsxs)(s.p,{children:["When a switch processor executes on a ",(0,t.jsx)(s.a,{href:"/docs/configuration/batching",children:"batch of messages"})," they are checked individually and can be matched independently against cases. During processing the messages matched against a case are processed as a batch, although the ordering of messages during case processing cannot be guaranteed to match the order as received."]}),"\n",(0,t.jsxs)(s.p,{children:["At the end of switch processing the resulting batch will follow the same ordering as the batch was received. If any child processors have split or otherwise grouped messages this grouping will be lost as the result of a switch is always a single batch. In order to perform conditional grouping and/or splitting use the ",(0,t.jsxs)(s.a,{href:"/docs/components/processors/group_by",children:[(0,t.jsx)(s.code,{children:"group_by"})," processor"]}),"."]})]})}function p(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},85162:function(e,s,n){n.d(s,{Z:function(){return o}});n(67294);var t=n(86010),r={tabItem:"tabItem_Ymn6"},a=n(85893);function o(e){let{children:s,hidden:n,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.Z)(r.tabItem,o),hidden:n,children:s})}},74866:function(e,s,n){n.d(s,{Z:function(){return y}});var t=n(67294),r=n(86010),a=n(12466),o=n(16550),l=n(20469),c=n(91980),i=n(67392),u=n(50012);function d(e){var s,n;return null!=(s=null==(n=t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?s:[]}function h(e){const{values:s,children:n}=e;return(0,t.useMemo)((()=>{const e=null!=s?s:function(e){return d(e).map((e=>{let{props:{value:s,label:n,attributes:t,default:r}}=e;return{value:s,label:n,attributes:t,default:r}}))}(n);return function(e){const s=(0,i.l)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error('Docusaurus error: Duplicate values "'+s.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[s,n])}function p(e){let{value:s,tabValues:n}=e;return n.some((e=>e.value===s))}function f(e){let{queryString:s=!1,groupId:n}=e;const r=(0,o.k6)(),a=function(e){let{queryString:s=!1,groupId:n}=e;if("string"==typeof s)return s;if(!1===s)return null;if(!0===s&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:s,groupId:n});return[(0,c._X)(a),(0,t.useCallback)((e=>{if(!a)return;const s=new URLSearchParams(r.location.search);s.set(a,e),r.replace({...r.location,search:s.toString()})}),[a,r])]}function g(e){const{defaultValue:s,queryString:n=!1,groupId:r}=e,a=h(e),[o,c]=(0,t.useState)((()=>function(e){var s;let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+t.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}const r=null!=(s=t.find((e=>e.default)))?s:t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:s,tabValues:a}))),[i,d]=f({queryString:n,groupId:r}),[g,m]=function(e){let{groupId:s}=e;const n=function(e){return e?"docusaurus.tab."+e:null}(s),[r,a]=(0,u.Nk)(n);return[r,(0,t.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),b=(()=>{const e=null!=i?i:g;return p({value:e,tabValues:a})?e:null})();(0,l.Z)((()=>{b&&c(b)}),[b]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error("Can't select invalid tab value="+e);c(e),d(e),m(e)}),[d,m,a]),tabValues:a}}var m=n(72389),b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},v=n(85893);function x(e){let{className:s,block:n,selectedValue:t,selectValue:o,tabValues:l}=e;const c=[],{blockElementScrollPositionUntilNextRender:i}=(0,a.o5)(),u=e=>{const s=e.currentTarget,n=c.indexOf(s),r=l[n].value;r!==t&&(i(s),o(r))},d=e=>{var s;let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var t;const s=c.indexOf(e.currentTarget)+1;n=null!=(t=c[s])?t:c[0];break}case"ArrowLeft":{var r;const s=c.indexOf(e.currentTarget)-1;n=null!=(r=c[s])?r:c[c.length-1];break}}null==(s=n)||s.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},s),children:l.map((e=>{let{value:s,label:n,attributes:a}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:t===s?0:-1,"aria-selected":t===s,ref:e=>c.push(e),onKeyDown:d,onClick:u,...a,className:(0,r.Z)("tabs__item",b.tabItem,null==a?void 0:a.className,{"tabs__item--active":t===s}),children:null!=n?n:s},s)}))})}function w(e){let{lazy:s,children:n,selectedValue:r}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(s){const e=a.find((e=>e.props.value===r));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:a.map(((e,s)=>(0,t.cloneElement)(e,{key:s,hidden:e.props.value!==r})))})}function j(e){const s=g(e);return(0,v.jsxs)("div",{className:(0,r.Z)("tabs-container",b.tabList),children:[(0,v.jsx)(x,{...e,...s}),(0,v.jsx)(w,{...e,...s})]})}function y(e){const s=(0,m.Z)();return(0,v.jsx)(j,{...e,children:d(e.children)},String(s))}},11151:function(e,s,n){n.d(s,{Z:function(){return l},a:function(){return o}});var t=n(67294);const r={},a=t.createContext(r);function o(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);