"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[5462],{66132:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return i},default:function(){return h},frontMatter:function(){return a},metadata:function(){return s},toc:function(){return c}});var o=t(85893),r=t(11151);const a={title:"Cross Post: We're Bringing Simple Back (to Streaming)",author:"Ashley Jeffs",author_url:"https://github.com/Jeffail",author_image_url:"/img/ash.jpg",keywords:["redpanda","stream processing","kafka"],tags:[]},i=void 0,s={permalink:"/bento/blog/2021/03/09/redpanda",source:"@site/blog/2021-03-09-redpanda.md",title:"Cross Post: We're Bringing Simple Back (to Streaming)",description:"(Cross-posted with https://vectorized.io/blog/benthos/)",date:"2021-03-09T00:00:00.000Z",formattedDate:"March 9, 2021",tags:[],readingTime:3.12,hasTruncateMarker:!0,authors:[{name:"Ashley Jeffs",url:"https://github.com/Jeffail",imageURL:"/img/ash.jpg"}],frontMatter:{title:"Cross Post: We're Bringing Simple Back (to Streaming)",author:"Ashley Jeffs",author_url:"https://github.com/Jeffail",author_image_url:"/img/ash.jpg",keywords:["redpanda","stream processing","kafka"],tags:[]},unlisted:!1,prevItem:{title:"Preview: Go Plugins V2 and Config Templates",permalink:"/bento/blog/2021/06/02/new-plugins-and-templates"},nextItem:{title:"First Look at the V4 Roadmap",permalink:"/bento/blog/2021/01/04/v4-roadmap"}},d={authorsImageUrls:[void 0]},c=[];function l(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["(Cross-posted with ",(0,o.jsx)(n.a,{href:"https://vectorized.io/blog/benthos/",children:"https://vectorized.io/blog/benthos/"}),")"]}),"\n",(0,o.jsx)(n.p,{children:"Combining the power of Redpanda and Bento for your streaming needs is so simple that this blog post is almost over already."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://www.benthos.dev/",children:"Bento"})," is an open source stream processor that provides data mapping, filtering, hydration and enrichment capabilities across a wide range of connectors. It is driven by a minimal, declarative configuration spec, and with a transaction based architecture it eliminates the development effort of building resilient stream processing pipelines."]}),"\n",(0,o.jsx)(n.p,{children:"Likewise, with its simplicity and high performance, Redpanda eliminates the operational effort of data persistence and availability by providing a Kafka-compatible streaming platform without the moving parts."}),"\n",(0,o.jsxs)(n.p,{children:["With so much taken care of you're well in for a boring, uneventful time when you combine the two. Make sure you've grabbed a copy of both services, full instructions can be found in the ",(0,o.jsx)(n.a,{href:"https://www.benthos.dev/docs/guides/getting_started",children:"getting started guide for Bento"})," and ",(0,o.jsx)(n.a,{href:"https://vectorized.io/docs",children:"the Redpanda docs"}),". In this post we'll be running them with Docker so we'll start by pulling both images:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker pull vectorized/redpanda:latest\ndocker pull jeffail/benthos:latest\n"})}),"\n",(0,o.jsx)(n.p,{children:"We can then create a new network for the services to connect with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker network create -d bridge redpandanet\n"})}),"\n",(0,o.jsx)(n.p,{children:"Next, run Redpanda in the background, we'll go with a single node for now:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker run -d \\\n  --network redpandanet \\\n  --name redpanda \\\n  -p 9092:9092 \\\n  vectorized/redpanda redpanda start \\\n  --reserve-memory 0M \\\n  --overprovisioned \\\n  --smp 1 \\\n  --memory 1G \\\n  --advertise-kafka-addr redpanda:9092\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In order to send data to Redpanda with Bento we'll need to create a config, starting off with a simple Stdin to Kafka pipeline, copy the following config into a file ",(0,o.jsx)(n.code,{children:"producer.yaml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"input:\n  stdin: {}\n\noutput:\n  kafka:\n    addresses: [ redpanda:9092 ]\n    topic: topic_A\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Pro tip: You can also use Bento itself to generate a config like this with ",(0,o.jsx)(n.code,{children:"docker run --rm jeffail/benthos create stdin//kafka > ./producer.yaml"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"And now run Bento by adding the config as a Docker volume, along with a pseudo-TTY for writing our messages:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker run --rm -it \\\n  --network redpandanet \\\n  -v $(pwd)/producer.yaml:/benthos.yaml \\\n  jeffail/benthos\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will open an interactive shell where you can write in some data to send. Bento will gobble up anything you throw at it, try mixing structured and unstructured messages, ending each message with a newline:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{"id":"1","data":"a structured message"}\nbut this here ain\'t structured at all!\n[{"id":"2"},"also structured in a different (but totally valid) way"]\n'})}),"\n",(0,o.jsx)(n.p,{children:"When you're finished hit CTRL+C and it'll exit."}),"\n",(0,o.jsxs)(n.p,{children:["Next, let's try reading that data back out from Redpanda, this time let's also add a ",(0,o.jsx)(n.a,{href:"https://www.benthos.dev/docs/components/processors/about",children:"processor"})," in order to mutate our data, copy the following into a file ",(0,o.jsx)(n.code,{children:"consumer.yaml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'input:\n  kafka:\n    addresses: [ redpanda:9092 ]\n    topics: [ topic_A ]\n    consumer_group: example_group\n\npipeline:\n  processors:\n    - bloblang: |\n        root.doc = this | content().string()\n        root.length = content().length()\n        root.topic = meta("kafka_topic")\n\noutput:\n  stdout: {}\n'})}),"\n",(0,o.jsx)(n.p,{children:"And run it with our new config, and without the pseudo-TTY this time:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"docker run --rm \\\n  --network redpandanet \\\n  -v $(pwd)/consumer.yaml:/benthos.yaml \\\n  jeffail/benthos\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now you should see it print mutated versions of the messages you sent to Stdout:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{"doc":{"data":"a structured message","id":"1"},"length":40,"topic":"topic_A"}\n{"doc":"but this here ain\'t structured at all!","length":38,"topic":"topic_A"}\n{"doc":[{"id":"2"},"also structured in a different (but totally valid) way"],"length":69,"topic":"topic_A"}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://www.benthos.dev/docs/components/processors/bloblang",children:"Bloblang processor"})," in our consumer config has remapped the original message to a new field ",(0,o.jsx)(n.code,{children:"doc"}),", first attempting to extract it as a structured document, but falling back to a stringified version of it when it's unstructured. We've also added a field ",(0,o.jsx)(n.code,{children:"length"})," which contains the length of the original message, and ",(0,o.jsx)(n.code,{children:"topic"})," which contains the Kafka topic the message was consumed from."]}),"\n",(0,o.jsxs)(n.p,{children:["That's it for now, if you're still hungry for more then check out the Bento website at ",(0,o.jsx)(n.a,{href:"https://www.benthos.dev/",children:"https://www.benthos.dev"}),", and you can learn more about the Bento mapping language Bloblang ",(0,o.jsx)(n.a,{href:"https://www.benthos.dev/docs/guides/bloblang/about",children:"in this guide"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},11151:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return i}});var o=t(67294);const r={},a=o.createContext(r);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);