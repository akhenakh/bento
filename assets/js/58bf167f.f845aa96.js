"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[8778],{3225:function(e,t,s){s.r(t),s.d(t,{assets:function(){return i},contentTitle:function(){return c},default:function(){return p},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return d}});var n=s(5893),o=s(1151),a=s(4866),r=s(5162);const l={title:"switch",slug:"switch",type:"output",status:"stable",categories:["Utility"],name:"switch"},c=void 0,u={id:"components/outputs/switch",title:"switch",description:"\x3c!--",source:"@site/docs/components/outputs/switch.md",sourceDirName:"components/outputs",slug:"/components/outputs/switch",permalink:"/bento/docs/components/outputs/switch",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/outputs/switch.md",tags:[],version:"current",frontMatter:{title:"switch",slug:"switch",type:"output",status:"stable",categories:["Utility"],name:"switch"},sidebar:"docs",previous:{title:"subprocess",permalink:"/bento/docs/components/outputs/subprocess"},next:{title:"sync_response",permalink:"/bento/docs/components/outputs/sync_response"}},i={},d=[{value:"Examples",id:"examples",level:2},{value:"Fields",id:"fields",level:2},{value:"<code>retry_until_success</code>",id:"retry_until_success",level:3},{value:"<code>strict_mode</code>",id:"strict_mode",level:3},{value:"<code>cases</code>",id:"cases",level:3},{value:"<code>cases[].check</code>",id:"casescheck",level:3},{value:"<code>cases[].output</code>",id:"casesoutput",level:3},{value:"<code>cases[].continue</code>",id:"casescontinue",level:3}];function h(e){const t={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"The switch output type allows you to route messages to different outputs based on their contents."}),"\n",(0,n.jsxs)(a.Z,{defaultValue:"common",values:[{label:"Common",value:"common"},{label:"Advanced",value:"advanced"}],children:[(0,n.jsx)(r.Z,{value:"common",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:'# Common config fields, showing default values\noutput:\n  label: ""\n  switch:\n    retry_until_success: false\n    cases: [] # No default (required)\n'})})}),(0,n.jsx)(r.Z,{value:"advanced",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:'# All config fields, showing default values\noutput:\n  label: ""\n  switch:\n    retry_until_success: false\n    strict_mode: false\n    cases: [] # No default (required)\n'})})})]}),"\n",(0,n.jsxs)(t.p,{children:["Messages that do not pass the check of a single output case are effectively dropped. In order to prevent this outcome set the field ",(0,n.jsx)(t.a,{href:"#strict_mode",children:(0,n.jsx)(t.code,{children:"strict_mode"})})," to ",(0,n.jsx)(t.code,{children:"true"}),", in which case messages that do not pass at least one case are considered failed and will be nacked and/or reprocessed depending on your input."]}),"\n",(0,n.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,n.jsxs)(a.Z,{defaultValue:"Basic Multiplexing",values:[{label:"Basic Multiplexing",value:"Basic Multiplexing"},{label:"Control Flow",value:"Control Flow"}],children:[(0,n.jsxs)(r.Z,{value:"Basic Multiplexing",children:[(0,n.jsxs)(t.p,{children:["The most common use for a switch output is to multiplex messages across a range of output destinations. The following config checks the contents of the field ",(0,n.jsx)(t.code,{children:"type"})," of messages and sends ",(0,n.jsx)(t.code,{children:"foo"})," type messages to an ",(0,n.jsx)(t.code,{children:"amqp_1"})," output, ",(0,n.jsx)(t.code,{children:"bar"})," type messages to a ",(0,n.jsx)(t.code,{children:"gcp_pubsub"})," output, and everything else to a ",(0,n.jsx)(t.code,{children:"redis_streams"})," output."]}),(0,n.jsxs)(t.p,{children:["Outputs can have their own processors associated with them, and in this example the ",(0,n.jsx)(t.code,{children:"redis_streams"})," output has a processor that enforces the presence of a type field before sending it."]}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'output:\n  switch:\n    cases:\n      - check: this.type == "foo"\n        output:\n          amqp_1:\n            urls: [ amqps://guest:guest@localhost:5672/ ]\n            target_address: queue:/the_foos\n\n      - check: this.type == "bar"\n        output:\n          gcp_pubsub:\n            project: dealing_with_mike\n            topic: mikes_bars\n\n      - output:\n          redis_streams:\n            url: tcp://localhost:6379\n            stream: everything_else\n          processors:\n            - mapping: |\n                root = this\n                root.type = this.type | "unknown"\n'})})]}),(0,n.jsxs)(r.Z,{value:"Control Flow",children:[(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"continue"})," field allows messages that have passed a case to be tested against the next one also. This can be useful when combining non-mutually-exclusive case checks."]}),(0,n.jsx)(t.p,{children:"In the following example a message that passes both the check of the first case as well as the second will be routed to both."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"output:\n  switch:\n    cases:\n      - check: 'this.user.interests.contains(\"walks\").catch(false)'\n        output:\n          amqp_1:\n            urls: [ amqps://guest:guest@localhost:5672/ ]\n            target_address: queue:/people_what_think_good\n        continue: true\n\n      - check: 'this.user.dislikes.contains(\"videogames\").catch(false)'\n        output:\n          gcp_pubsub:\n            project: people\n            topic: that_i_dont_want_to_hang_with\n"})})]})]}),"\n",(0,n.jsx)(t.h2,{id:"fields",children:"Fields"}),"\n",(0,n.jsx)(t.h3,{id:"retry_until_success",children:(0,n.jsx)(t.code,{children:"retry_until_success"})}),"\n",(0,n.jsx)(t.p,{children:"If a selected output fails to send a message this field determines whether it is reattempted indefinitely. If set to false the error is instead propagated back to the input level."}),"\n",(0,n.jsx)(t.p,{children:"If a message can be routed to >1 outputs it is usually best to set this to true in order to avoid duplicate messages being routed to an output."}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"bool"}),(0,n.jsx)(t.br,{}),"\n","Default: ",(0,n.jsx)(t.code,{children:"false"})]}),"\n",(0,n.jsx)(t.h3,{id:"strict_mode",children:(0,n.jsx)(t.code,{children:"strict_mode"})}),"\n",(0,n.jsx)(t.p,{children:"This field determines whether an error should be reported if no condition is met. If set to true, an error is propagated back to the input level. The default behavior is false, which will drop the message."}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"bool"}),(0,n.jsx)(t.br,{}),"\n","Default: ",(0,n.jsx)(t.code,{children:"false"})]}),"\n",(0,n.jsx)(t.h3,{id:"cases",children:(0,n.jsx)(t.code,{children:"cases"})}),"\n",(0,n.jsx)(t.p,{children:"A list of switch cases, outlining outputs that can be routed to."}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"array"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:'# Examples\n\ncases:\n  - check: this.urls.contains("http://benthos.dev")\n    continue: true\n    output:\n      cache:\n        key: ${!json("id")}\n        target: foo\n  - output:\n      s3:\n        bucket: bar\n        path: ${!json("id")}\n'})}),"\n",(0,n.jsx)(t.h3,{id:"casescheck",children:(0,n.jsx)(t.code,{children:"cases[].check"})}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.a,{href:"/docs/guides/bloblang/about/",children:"Bloblang query"})," that should return a boolean value indicating whether a message should be routed to the case output. If left empty the case always passes."]}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"string"}),(0,n.jsx)(t.br,{}),"\n","Default: ",(0,n.jsx)(t.code,{children:'""'})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:'# Examples\n\ncheck: this.type == "foo"\n\ncheck: this.contents.urls.contains("https://benthos.dev/")\n'})}),"\n",(0,n.jsx)(t.h3,{id:"casesoutput",children:(0,n.jsx)(t.code,{children:"cases[].output"})}),"\n",(0,n.jsxs)(t.p,{children:["An ",(0,n.jsx)(t.a,{href:"/docs/components/outputs/about/",children:"output"})," for messages that pass the check to be routed to."]}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"output"})]}),"\n",(0,n.jsx)(t.h3,{id:"casescontinue",children:(0,n.jsx)(t.code,{children:"cases[].continue"})}),"\n",(0,n.jsx)(t.p,{children:"Indicates whether, if this case passes for a message, the next case should also be tested."}),"\n",(0,n.jsxs)(t.p,{children:["Type: ",(0,n.jsx)(t.code,{children:"bool"}),(0,n.jsx)(t.br,{}),"\n","Default: ",(0,n.jsx)(t.code,{children:"false"})]})]})}function p(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},5162:function(e,t,s){s.d(t,{Z:function(){return r}});s(7294);var n=s(6010),o={tabItem:"tabItem_Ymn6"},a=s(5893);function r(e){let{children:t,hidden:s,className:r}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,n.Z)(o.tabItem,r),hidden:s,children:t})}},4866:function(e,t,s){s.d(t,{Z:function(){return y}});var n=s(7294),o=s(6010),a=s(2466),r=s(6550),l=s(469),c=s(1980),u=s(7392),i=s(12);function d(e){var t,s;return null!=(t=null==(s=n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:s.filter(Boolean))?t:[]}function h(e){const{values:t,children:s}=e;return(0,n.useMemo)((()=>{const e=null!=t?t:function(e){return d(e).map((e=>{let{props:{value:t,label:s,attributes:n,default:o}}=e;return{value:t,label:s,attributes:n,default:o}}))}(s);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,s])}function p(e){let{value:t,tabValues:s}=e;return s.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:s}=e;const o=(0,r.k6)(),a=function(e){let{queryString:t=!1,groupId:s}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=s?s:null}({queryString:t,groupId:s});return[(0,c._X)(a),(0,n.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(o.location.search);t.set(a,e),o.replace({...o.location,search:t.toString()})}),[a,o])]}function m(e){const{defaultValue:t,queryString:s=!1,groupId:o}=e,a=h(e),[r,c]=(0,n.useState)((()=>function(e){var t;let{defaultValue:s,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!p({value:s,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+s+'" but none of its children has the corresponding value. Available values are: '+n.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return s}const o=null!=(t=n.find((e=>e.default)))?t:n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:t,tabValues:a}))),[u,d]=f({queryString:s,groupId:o}),[m,b]=function(e){let{groupId:t}=e;const s=function(e){return e?"docusaurus.tab."+e:null}(t),[o,a]=(0,i.Nk)(s);return[o,(0,n.useCallback)((e=>{s&&a.set(e)}),[s,a])]}({groupId:o}),x=(()=>{const e=null!=u?u:m;return p({value:e,tabValues:a})?e:null})();(0,l.Z)((()=>{x&&c(x)}),[x]);return{selectedValue:r,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error("Can't select invalid tab value="+e);c(e),d(e),b(e)}),[d,b,a]),tabValues:a}}var b=s(2389),x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},g=s(5893);function v(e){let{className:t,block:s,selectedValue:n,selectValue:r,tabValues:l}=e;const c=[],{blockElementScrollPositionUntilNextRender:u}=(0,a.o5)(),i=e=>{const t=e.currentTarget,s=c.indexOf(t),o=l[s].value;o!==n&&(u(t),r(o))},d=e=>{var t;let s=null;switch(e.key){case"Enter":i(e);break;case"ArrowRight":{var n;const t=c.indexOf(e.currentTarget)+1;s=null!=(n=c[t])?n:c[0];break}case"ArrowLeft":{var o;const t=c.indexOf(e.currentTarget)-1;s=null!=(o=c[t])?o:c[c.length-1];break}}null==(t=s)||t.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":s},t),children:l.map((e=>{let{value:t,label:s,attributes:a}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>c.push(e),onKeyDown:d,onClick:i,...a,className:(0,o.Z)("tabs__item",x.tabItem,null==a?void 0:a.className,{"tabs__item--active":n===t}),children:null!=s?s:t},t)}))})}function j(e){let{lazy:t,children:s,selectedValue:o}=e;const a=(Array.isArray(s)?s:[s]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===o));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==o})))})}function w(e){const t=m(e);return(0,g.jsxs)("div",{className:(0,o.Z)("tabs-container",x.tabList),children:[(0,g.jsx)(v,{...e,...t}),(0,g.jsx)(j,{...e,...t})]})}function y(e){const t=(0,b.Z)();return(0,g.jsx)(w,{...e,children:d(e.children)},String(t))}},1151:function(e,t,s){s.d(t,{Z:function(){return l},a:function(){return r}});var n=s(7294);const o={},a=n.createContext(o);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);