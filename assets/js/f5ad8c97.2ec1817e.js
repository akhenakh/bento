"use strict";(self.webpackChunkbento=self.webpackChunkbento||[]).push([[8069],{123:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return u}});var a=t(5893),o=t(1151),r=t(4866),s=t(5162);const i={title:"azure_cosmosdb",slug:"azure_cosmosdb",type:"input",status:"experimental",categories:["Azure"],name:"azure_cosmosdb"},l=void 0,c={id:"components/inputs/azure_cosmosdb",title:"azure_cosmosdb",description:"\x3c!--",source:"@site/docs/components/inputs/azure_cosmosdb.md",sourceDirName:"components/inputs",slug:"/components/inputs/azure_cosmosdb",permalink:"/bento/docs/components/inputs/azure_cosmosdb",draft:!1,unlisted:!1,editUrl:"https://github.com/warpstreamlabs/bento/edit/main/website/docs/components/inputs/azure_cosmosdb.md",tags:[],version:"current",frontMatter:{title:"azure_cosmosdb",slug:"azure_cosmosdb",type:"input",status:"experimental",categories:["Azure"],name:"azure_cosmosdb"},sidebar:"docs",previous:{title:"azure_blob_storage",permalink:"/bento/docs/components/inputs/azure_blob_storage"},next:{title:"azure_queue_storage",permalink:"/bento/docs/components/inputs/azure_queue_storage"}},d={},u=[{value:"Cross-partition Queries",id:"cross-partition-queries",level:2},{value:"Credentials",id:"credentials",level:2},{value:"Metadata",id:"metadata",level:2},{value:"Examples",id:"examples",level:2},{value:"Fields",id:"fields",level:2},{value:"<code>endpoint</code>",id:"endpoint",level:3},{value:"<code>account_key</code>",id:"account_key",level:3},{value:"<code>connection_string</code>",id:"connection_string",level:3},{value:"<code>database</code>",id:"database",level:3},{value:"<code>container</code>",id:"container",level:3},{value:"<code>partition_keys_map</code>",id:"partition_keys_map",level:3},{value:"<code>query</code>",id:"query",level:3},{value:"<code>args_mapping</code>",id:"args_mapping",level:3},{value:"<code>batch_count</code>",id:"batch_count",level:3},{value:"<code>auto_replay_nacks</code>",id:"auto_replay_nacks",level:3},{value:"CosmosDB Emulator",id:"cosmosdb-emulator",level:2}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.admonition,{title:"EXPERIMENTAL",type:"caution",children:(0,a.jsx)(n.p,{children:"This component is experimental and therefore subject to change or removal outside of major version releases."})}),"\n",(0,a.jsxs)(n.p,{children:["Executes a SQL query against ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/cosmos-db/introduction",children:"Azure CosmosDB"})," and creates a batch of messages from each page of items."]}),"\n",(0,a.jsx)(n.p,{children:"Introduced in version v4.25.0."}),"\n",(0,a.jsxs)(r.Z,{defaultValue:"common",values:[{label:"Common",value:"common"},{label:"Advanced",value:"advanced"}],children:[(0,a.jsx)(s.Z,{value:"common",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# Common config fields, showing default values\ninput:\n  label: ""\n  azure_cosmosdb:\n    endpoint: https://localhost:8081 # No default (optional)\n    account_key: \'!!!SECRET_SCRUBBED!!!\' # No default (optional)\n    connection_string: \'!!!SECRET_SCRUBBED!!!\' # No default (optional)\n    database: testdb # No default (required)\n    container: testcontainer # No default (required)\n    partition_keys_map: root = "blobfish" # No default (required)\n    query: SELECT c.foo FROM testcontainer AS c WHERE c.bar = "baz" AND c.timestamp < @timestamp # No default (required)\n    args_mapping: |- # No default (optional)\n      root = [\n        { "Name": "@name", "Value": "bento" },\n      ]\n    auto_replay_nacks: true\n'})})}),(0,a.jsx)(s.Z,{value:"advanced",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# All config fields, showing default values\ninput:\n  label: ""\n  azure_cosmosdb:\n    endpoint: https://localhost:8081 # No default (optional)\n    account_key: \'!!!SECRET_SCRUBBED!!!\' # No default (optional)\n    connection_string: \'!!!SECRET_SCRUBBED!!!\' # No default (optional)\n    database: testdb # No default (required)\n    container: testcontainer # No default (required)\n    partition_keys_map: root = "blobfish" # No default (required)\n    query: SELECT c.foo FROM testcontainer AS c WHERE c.bar = "baz" AND c.timestamp < @timestamp # No default (required)\n    args_mapping: |- # No default (optional)\n      root = [\n        { "Name": "@name", "Value": "bento" },\n      ]\n    batch_count: -1\n    auto_replay_nacks: true\n'})})})]}),"\n",(0,a.jsx)(n.h2,{id:"cross-partition-queries",children:"Cross-partition Queries"}),"\n",(0,a.jsxs)(n.p,{children:["Cross-partition queries are currently not supported by the underlying driver. For every query, the PartitionKey value(s) must be known in advance and specified in the config. See details ",(0,a.jsx)(n.a,{href:"https://github.com/Azure/azure-sdk-for-go/issues/18578#issuecomment-1222510989",children:"here"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"credentials",children:"Credentials"}),"\n",(0,a.jsx)(n.p,{children:"You can use one of the following authentication mechanisms:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Set the ",(0,a.jsx)(n.code,{children:"endpoint"})," field and the ",(0,a.jsx)(n.code,{children:"account_key"})," field"]}),"\n",(0,a.jsxs)(n.li,{children:["Set only the ",(0,a.jsx)(n.code,{children:"endpoint"})," field to use ",(0,a.jsx)(n.a,{href:"https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/azidentity#DefaultAzureCredential",children:"DefaultAzureCredential"})]}),"\n",(0,a.jsxs)(n.li,{children:["Set the ",(0,a.jsx)(n.code,{children:"connection_string"})," field"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"metadata",children:"Metadata"}),"\n",(0,a.jsx)(n.p,{children:"This component adds the following metadata fields to each message:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"- activity_id\n- request_charge\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can access these metadata fields using ",(0,a.jsx)(n.a,{href:"/docs/configuration/interpolation#bloblang-queries",children:"function interpolation"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(r.Z,{defaultValue:"Query container",values:[{label:"Query container",value:"Query container"}],children:(0,a.jsxs)(s.Z,{value:"Query container",children:[(0,a.jsx)(n.p,{children:"Execute a parametrized SQL query to select documents from a container."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'input:\n  azure_cosmosdb:\n    endpoint: http://localhost:8080\n    account_key: C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==\n    database: blobbase\n    container: blobfish\n    partition_keys_map: root = "AbyssalPlain"\n    query: SELECT * FROM blobfish AS b WHERE b.species = @species\n    args_mapping: |\n      root = [\n          { "Name": "@species", "Value": "smooth-head" },\n      ]\n'})})]})}),"\n",(0,a.jsx)(n.h2,{id:"fields",children:"Fields"}),"\n",(0,a.jsx)(n.h3,{id:"endpoint",children:(0,a.jsx)(n.code,{children:"endpoint"})}),"\n",(0,a.jsx)(n.p,{children:"CosmosDB endpoint."}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"# Examples\n\nendpoint: https://localhost:8081\n"})}),"\n",(0,a.jsx)(n.h3,{id:"account_key",children:(0,a.jsx)(n.code,{children:"account_key"})}),"\n",(0,a.jsx)(n.p,{children:"Account key."}),"\n",(0,a.jsx)(n.admonition,{title:"Secret",type:"warning",children:(0,a.jsxs)(n.p,{children:["This field contains sensitive information that usually shouldn't be added to a config directly, read our ",(0,a.jsx)(n.a,{href:"/docs/configuration/secrets",children:"secrets page for more info"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"# Examples\n\naccount_key: C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==\n"})}),"\n",(0,a.jsx)(n.h3,{id:"connection_string",children:(0,a.jsx)(n.code,{children:"connection_string"})}),"\n",(0,a.jsx)(n.p,{children:"Connection string."}),"\n",(0,a.jsx)(n.admonition,{title:"Secret",type:"warning",children:(0,a.jsxs)(n.p,{children:["This field contains sensitive information that usually shouldn't be added to a config directly, read our ",(0,a.jsx)(n.a,{href:"/docs/configuration/secrets",children:"secrets page for more info"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"# Examples\n\nconnection_string: AccountEndpoint=https://localhost:8081/;AccountKey=C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"database",children:(0,a.jsx)(n.code,{children:"database"})}),"\n",(0,a.jsx)(n.p,{children:"Database."}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"# Examples\n\ndatabase: testdb\n"})}),"\n",(0,a.jsx)(n.h3,{id:"container",children:(0,a.jsx)(n.code,{children:"container"})}),"\n",(0,a.jsx)(n.p,{children:"Container."}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:"# Examples\n\ncontainer: testcontainer\n"})}),"\n",(0,a.jsx)(n.h3,{id:"partition_keys_map",children:(0,a.jsx)(n.code,{children:"partition_keys_map"})}),"\n",(0,a.jsxs)(n.p,{children:["A ",(0,a.jsx)(n.a,{href:"/docs/guides/bloblang/about",children:"Bloblang mapping"})," which should evaluate to a single partition key value or an array of partition key values of type string, integer or boolean. Currently, hierarchical partition keys are not supported so only one value may be provided."]}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# Examples\n\npartition_keys_map: root = "blobfish"\n\npartition_keys_map: root = 41\n\npartition_keys_map: root = true\n\npartition_keys_map: root = null\n\npartition_keys_map: root = now().ts_format("2006-01-02")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"query",children:(0,a.jsx)(n.code,{children:"query"})}),"\n",(0,a.jsx)(n.p,{children:"The query to execute"}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# Examples\n\nquery: SELECT c.foo FROM testcontainer AS c WHERE c.bar = "baz" AND c.timestamp < @timestamp\n'})}),"\n",(0,a.jsx)(n.h3,{id:"args_mapping",children:(0,a.jsx)(n.code,{children:"args_mapping"})}),"\n",(0,a.jsxs)(n.p,{children:["A ",(0,a.jsx)(n.a,{href:"/docs/guides/bloblang/about",children:"Bloblang mapping"})," that, for each message, creates a list of arguments to use with the query."]}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"string"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yml",children:'# Examples\n\nargs_mapping: |-\n  root = [\n    { "Name": "@name", "Value": "bento" },\n  ]\n'})}),"\n",(0,a.jsx)(n.h3,{id:"batch_count",children:(0,a.jsx)(n.code,{children:"batch_count"})}),"\n",(0,a.jsx)(n.p,{children:"The maximum number of messages that should be accumulated into each batch. Use '-1' specify dynamic page size."}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"int"}),(0,a.jsx)(n.br,{}),"\n","Default: ",(0,a.jsx)(n.code,{children:"-1"})]}),"\n",(0,a.jsx)(n.h3,{id:"auto_replay_nacks",children:(0,a.jsx)(n.code,{children:"auto_replay_nacks"})}),"\n",(0,a.jsxs)(n.p,{children:["Whether messages that are rejected (nacked) at the output level should be automatically replayed indefinitely, eventually resulting in back pressure if the cause of the rejections is persistent. If set to ",(0,a.jsx)(n.code,{children:"false"})," these messages will instead be deleted. Disabling auto replays can greatly improve memory efficiency of high throughput streams as the original shape of the data can be discarded immediately upon consumption and mutation."]}),"\n",(0,a.jsxs)(n.p,{children:["Type: ",(0,a.jsx)(n.code,{children:"bool"}),(0,a.jsx)(n.br,{}),"\n","Default: ",(0,a.jsx)(n.code,{children:"true"})]}),"\n",(0,a.jsx)(n.h2,{id:"cosmosdb-emulator",children:"CosmosDB Emulator"}),"\n",(0,a.jsxs)(n.p,{children:["If you wish to run the CosmosDB emulator that is referenced in the documentation ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/cosmos-db/linux-emulator",children:"here"}),", the following Docker command should do the trick:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"> docker run --rm -it -p 8081:8081 --name=cosmosdb -e AZURE_COSMOS_EMULATOR_PARTITION_COUNT=10 -e AZURE_COSMOS_EMULATOR_ENABLE_DATA_PERSISTENCE=false mcr.microsoft.com/cosmosdb/linux/azure-cosmos-emulator\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Note: ",(0,a.jsx)(n.code,{children:"AZURE_COSMOS_EMULATOR_PARTITION_COUNT"})," controls the number of partitions that will be supported by the emulator. The bigger the value, the longer it takes for the container to start up."]}),"\n",(0,a.jsxs)(n.p,{children:["Additionally, instead of installing the container self-signed certificate which is exposed via ",(0,a.jsx)(n.code,{children:"https://localhost:8081/_explorer/emulator.pem"}),", you can run ",(0,a.jsx)(n.a,{href:"https://mitmproxy.org/",children:"mitmproxy"})," like so:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'> mitmproxy -k --mode "reverse:https://localhost:8081"\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Then you can access the CosmosDB UI via ",(0,a.jsx)(n.code,{children:"http://localhost:8080/_explorer/index.html"})," and use ",(0,a.jsx)(n.code,{children:"http://localhost:8080"})," as the CosmosDB endpoint."]})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},5162:function(e,n,t){t.d(n,{Z:function(){return s}});t(7294);var a=t(6010),o={tabItem:"tabItem_Ymn6"},r=t(5893);function s(e){let{children:n,hidden:t,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,s),hidden:t,children:n})}},4866:function(e,n,t){t.d(n,{Z:function(){return _}});var a=t(7294),o=t(6010),r=t(2466),s=t(6550),i=t(469),l=t(1980),c=t(7392),d=t(12);function u(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:o}}=e;return{value:n,label:t,attributes:a,default:o}}))}(t);return function(e){const n=(0,c.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const o=(0,s.k6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l._X)(r),(0,a.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(o.location.search);n.set(r,e),o.replace({...o.location,search:n.toString()})}),[r,o])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,r=h(e),[s,l]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const o=null!=(n=a.find((e=>e.default)))?n:a[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:r}))),[c,u]=m({queryString:t,groupId:o}),[f,b]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[o,r]=(0,d.Nk)(t);return[o,(0,a.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:o}),x=(()=>{const e=null!=c?c:f;return p({value:e,tabValues:r})?e:null})();(0,i.Z)((()=>{x&&l(x)}),[x]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error("Can't select invalid tab value="+e);l(e),u(e),b(e)}),[u,b,r]),tabValues:r}}var b=t(2389),x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"},g=t(5893);function j(e){let{className:n,block:t,selectedValue:a,selectValue:s,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.o5)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),o=i[t].value;o!==a&&(c(n),s(o))},u=e=>{var n;let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{var a;const n=l.indexOf(e.currentTarget)+1;t=null!=(a=l[n])?a:l[0];break}case"ArrowLeft":{var o;const n=l.indexOf(e.currentTarget)-1;t=null!=(o=l[n])?o:l[l.length-1];break}}null==(n=t)||n.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n),children:i.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>l.push(e),onKeyDown:u,onClick:d,...r,className:(0,o.Z)("tabs__item",x.tabItem,null==r?void 0:r.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function y(e){let{lazy:n,children:t,selectedValue:o}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===o));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function v(e){const n=f(e);return(0,g.jsxs)("div",{className:(0,o.Z)("tabs-container",x.tabList),children:[(0,g.jsx)(j,{...e,...n}),(0,g.jsx)(y,{...e,...n})]})}function _(e){const n=(0,b.Z)();return(0,g.jsx)(v,{...e,children:u(e.children)},String(n))}},1151:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return s}});var a=t(7294);const o={},r=a.createContext(o);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);